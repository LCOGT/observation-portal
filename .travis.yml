language: python
dist: xenial   # required for Python >= 3.7
python:
- '3.6'
- '3.7'
- '3.8'
env:
  global:
  - NODE_VERSION='10'
  - DOCKER_USERNAME='observatorycontrolsystem'
  - secure: WuhoeiPIIcQdgyMwg3HTPh918qpZJX+Dh+QjeVQpBWwZyEcyCcdWHp7+PGzoS3iFlb1OrhsuamHGE+hlzrbD2BR7DBXVaiWdKpkL0cWoOeX7Bu8vpoJoPP5oKJVwaThIcyC3nb11yhHYqwO41at8bTbuJ/M4ooFKt8nGvdsO2zXJdSYHN64GNII3CyCXLN69IktZSvnLW43S1wBEbV26dV1i59ncbqiFFr/nz8jxoMAS6Nwy2ewWrDq1788D8TlMAvtPtfQOtsGfDA+H+zBKpWfZEjNPJ6IPIlJU335/n3SuMgk3jPb0gXCNQKeEgy6BXWt/DsESGPwOa036RBE01awWMPc9wz1e0qxd5wL07kZFGDmDXX65UPcJYaqarXcIn9Efp7scRDyah5D1elOVoV09ADhUHyovfjRc9Q/Xxq0Tn7fNKVRQjNwKVOsXAuL3huDjVsWGtLkugDFVNpOyHwx6VuToNtxI3WSfufwMn9P9LtxjOL/jSQF897XcaZPc3HEVo+mrRuonJOW54rfIq7qH2yuAlJIob2B5zcGxVYnWaNO8DV+czzH16n7CrX+Cds59qPaliBYjU9i05WgwWsBl278XshheXwxyEDlfonOyLHCpP6T3qoYpWAnP4WMvisvipMFeFHjx0BrjSy26sbeRkbHpJVPEC3Tuj41wcJI=
before_install:
- nvm install $NODE_VERSION
addons:
  postgresql: '9.6'
  apt:
    packages:
    - gfortran
services:
- postgresql
- docker
before_script:
- psql -c 'create database observation_portal;' -U postgres
install:
- pip install -U coverage coveralls
- pip install -r requirements.txt
- npm install
- npm run build
script: coverage run manage.py test --settings=test_settings
after_success: coveralls
deploy:
  provider: script
  script: bash docker_push
  skip_cleanup: true
  on:
    branch: test_conventions
